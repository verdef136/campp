<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Campionato — Classifica minimal</title>
  <style>
    :root{
      --bg:#f6f7fb; --card:#fff; --muted:#6b7280; --accent:#0ea5a4;
    }
    *{box-sizing:border-box}
    body{font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; background:var(--bg); margin:0; color:#0f172a}
    .wrap{max-width:980px;margin:28px auto;padding:18px}
    header{display:flex;align-items:center;gap:14px;margin-bottom:18px}
    .brand{font-weight:700;font-size:20px}
    .subtitle{color:var(--muted);font-size:13px}
    .grid{display:grid;grid-template-columns:1fr 340px;gap:18px}
    .card{background:var(--card);border-radius:12px;padding:16px;box-shadow:0 6px 20px rgba(12,16,30,0.06)}
    table{width:100%;border-collapse:collapse;font-size:14px}
    th,td{padding:8px 10px;text-align:left}
    th{font-size:12px;color:var(--muted);font-weight:600;text-transform:uppercase}
    tr:not(:first-child):hover{background:rgba(14,165,164,0.04)}
    .pos{width:34px;text-align:center;font-weight:700}
    .team{display:flex;gap:10px;align-items:center}
    .badge{width:32px;height:32px;border-radius:6px;background:#eef2f7;display:inline-flex;align-items:center;justify-content:center;font-size:12px;color:#334155;object-fit:contain}
    .small{font-size:13px;color:var(--muted)}
    .controls{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
    .btn{background:transparent;border:1px solid #e6e9ef;padding:8px 10px;border-radius:8px;font-weight:600;cursor:pointer}
    .btn.primary{background:var(--accent);color:white;border-color:transparent}
    .scorers{list-style:none;padding:0;margin:0}
    .scorers li{padding:8px 0;border-bottom:1px dashed #eef2f7;display:flex;justify-content:space-between}
    .muted{color:var(--muted)}
    textarea{width:100%;min-height:120px;font-family:monospace;font-size:13px;padding:8px;border-radius:8px;border:1px solid #e6e9ef}
    .small-note{font-size:12px;color:var(--muted);margin-top:8px}
    .matchday{margin-bottom:12px;border-top:1px solid #f1f5f9;padding-top:10px}
    .match{display:flex;justify-content:space-between;align-items:center;padding:6px 0}
    .match .teams{display:flex;gap:8px;align-items:center}
    .match .score{font-weight:700;min-width:64px;text-align:center}
    .match .scorers{font-size:13px;color:var(--muted);margin-top:4px}
    @media (max-width:820px){.grid{grid-template-columns:1fr;}.wrap{padding:12px}}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">Campionato — Minimal</div>
      <div class="subtitle">Manchester City, Santos, Napoli, Atletico Madrid</div>
    </header>

    <div class="grid">
      <main class="card">
        <h2 style="margin-top:0;margin-bottom:6px">Classifica</h2>
        <div class="small">I dati vengono salvati localmente nel browser — modifica il JSON a destra e premi <strong>Applica dati</strong>.</div>

        <div style="overflow:auto;margin-top:12px">
          <table id="table-standings" aria-label="Classifica">
            <thead>
              <tr>
                <th class="pos">#</th>
                <th>Squadra</th>
                <th>P</th>
                <th>V</th>
                <th>N</th>
                <th>Per</th>
                <th>Gol Fatti</th>
                <th>Gol Subiti</th>
                <th>Diff. Reti</th>
                <th>Pt</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>

        <div class="controls">
          <button class="btn" onclick="sortBy('pts')">Ordina per Punti</button>
          <button class="btn" onclick="sortBy('gd')">Ordina per Diff. Reti</button>
          <button class="btn" onclick="sortBy('gf')">Ordina per Gol</button>
          <button class="btn" onclick="clearStorage()">Cancella salvataggio</button>
        </div>
      </main>

      <aside>
        <div class="card" style="margin-bottom:12px">
          <h3 style="margin:0 0 8px 0">Migliori marcatori</h3>
          <ul id="scorers" class="scorers"></ul>
          <div class="small-note">Clicca su un marcatore per evidenziare la sua squadra nella classifica.</div>
        </div>

        <div class="card">
          <h3 style="margin:0 0 8px 0">Dati (JSON)</h3>
          <textarea id="json-data"></textarea>
          <div style="display:flex;gap:8px;margin-top:8px">
            <button class="btn primary" onclick="applyData()">Applica dati</button>
            <button class="btn" onclick="downloadHTML()">Scarica .html</button>
          </div>
          <div class="small-note">Modifica i valori se vuoi — teams, scorers, matchdays. I dati vengono salvati nel tuo browser.</div>
        </div>
      </aside>

      <!-- Ultime giornate -->
      <section class="card" style="grid-column:1 / -1; margin-top:18px">
        <h2 style="margin-top:0;margin-bottom:6px">Ultime Giornate</h2>
        <div id="matchdays"></div>
      </section>

    </div>
  </div>

  <script>
    // --- Dati iniziali derivati dalle giornate che mi hai fornito ---
    const initialData = {
      teams: [
        // id must match images filenames (without path)
        { id: 'MC', name: 'Manchester City', played: 3, win: 0, draw: 1, loss: 2, gf: 5, ga: 11 },
        { id: 'S', name: 'Santos', played: 3, win: 1, draw: 0, loss: 2, gf: 7, ga: 13 },
        { id: 'N', name: 'Napoli', played: 3, win: 2, draw: 1, loss: 0, gf: 9, ga: 2 },
        { id: 'AM', name: 'Atletico Madrid', played: 3, win: 1, draw: 2, loss: 0, gf: 7, ga: 2 }
      ],
      // scorers aggregated from tutte le giornate
      scorers: [
        { player: 'Kylian Mbappé', teamId: 'N', goals: 7 },
        { player: 'Robert Lewandowski', teamId: 'S', goals: 3 },
        { player: 'Erling Haaland', teamId: 'MC', goals: 2 },
        { player: 'Ousmane Dembélé', teamId: 'AM', goals: 2 },
        { player: 'Karim Benzema', teamId: 'S', goals: 2 },
        { player: 'Cristiano Ronaldo', teamId: 'AM', goals: 2 },
        { player: 'Vinicius', teamId: 'AM', goals: 2 },
        { player: 'Lionel Messi', teamId: 'S', goals: 1 },
        { player: 'João Félix', teamId: 'S', goals: 1 },
        { player: 'Paulo Dybala', teamId: 'MC', goals: 1 },
        { player: 'Marco Verratti', teamId: 'MC', goals: 1 },
        { player: 'Paul Pogba', teamId: 'MC', goals: 1 },
        { player: 'Timo Werner', teamId: 'N', goals: 1 },
        { player: 'Marcus Rashford', teamId: 'AM', goals: 1 },
        { player: 'Heung-min Son', teamId: 'N', goals: 1 }
      ],
      // matchdays as provided (compact style)
      matchdays: [
        {
          giornata: 1,
          date: "", // optional
          matches: [
            { homeId: 'MC', awayId: 'AM', score: '1-1', scorersHome: ['Paul Pogba'], scorersAway: ['Cristiano Ronaldo'] },
            { homeId: 'S', awayId: 'N', score: '1-4', scorersHome: ['Robert Lewandowski'], scorersAway: ['Kylian Mbappé','Kylian Mbappé','Kylian Mbappé','Kylian Mbappé'] }
          ]
        },
        {
          giornata: 2,
          date: "",
          matches: [
            { homeId: 'AM', awayId: 'N', score: '1-1', scorersHome: ['Vinicius'], scorersAway: ['Timo Werner'] },
            { homeId: 'MC', awayId: 'S', score: '4-6', scorersHome: ['Paulo Dybala','Marco Verratti','Erling Haaland','Erling Haaland'], scorersAway: ['Lionel Messi','João Félix','Robert Lewandowski','Robert Lewandowski','Karim Benzema','Karim Benzema'] }
          ]
        },
        {
          giornata: 3,
          date: "",
          matches: [
            { homeId: 'AM', awayId: 'S', score: '5-0', scorersHome: ['Ousmane Dembélé','Ousmane Dembélé','Cristiano Ronaldo','Vinicius','Marcus Rashford'], scorersAway: [] },
            { homeId: 'MC', awayId: 'N', score: '0-4', scorersHome: [], scorersAway: ['Kylian Mbappé','Kylian Mbappé','Kylian Mbappé','Heung-min Son'] }
          ]
        }
      ]
    };

    // Utility: enrich teams with pts and gd
    function enrichTeams(teams){
      return teams.map(t=>{
        const pts = (t.win||0)*3 + (t.draw||0);
        const gd = (t.gf||0) - (t.ga||0);
        return {...t, pts, gd};
      });
    }

    // Render standings table
    function renderStandings(data){
      const tbody = document.querySelector('#table-standings tbody');
      tbody.innerHTML = '';
      const teams = enrichTeams(data.teams.slice()).sort((a,b)=>b.pts - a.pts || b.gd - a.gd || b.gf - a.gf);
      teams.forEach((t,i)=>{
        const tr = document.createElement('tr');
        tr.dataset.teamId = t.id;
        tr.innerHTML = `
          <td class="pos">${i+1}</td>
          <td>
            <div class="team">
              <img src="images/${t.id}.png" alt="${t.name} logo" class="badge" onerror="this.style.display='inline-block'; this.src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAAR0lEQVR4nO3RMQ0AAAjDMO5fNNSwY8Q0cSgkQwYMGDBgwIABAwYMGCBAwYMGDBgwIABAwYMGCBAwYMGDBgwIABAwYMGDBg0Ft8B0S0dXn9gAAAAASUVORK5CYII='"> 
              <div>
                <div style="font-weight:700">${t.name}</div>
                <div class="small">Giocate: ${t.played}</div>
              </div>
            </div>
          </td>
          <td>${t.played}</td>
          <td>${t.win}</td>
          <td>${t.draw}</td>
          <td>${t.loss}</td>
          <td>${t.gf}</td>
          <td>${t.ga}</td>
          <td>${t.gd}</td>
          <td style="font-weight:700">${t.pts}</td>
        `;
        tbody.appendChild(tr);
      });
    }

    // Render scorers list
    function renderScorers(data){
      const ul = document.getElementById('scorers');
      ul.innerHTML = '';
      // sort by goals desc
      const list = data.scorers.slice().sort((a,b)=>b.goals - a.goals || a.player.localeCompare(b.player));
      list.forEach(s=>{
        const li = document.createElement('li');
        li.innerHTML = `<div><strong>${s.player}</strong><div class="small">${getTeamName(data, s.teamId)}</div></div><div style="font-weight:700">${s.goals}</div>`;
        li.style.cursor = 'pointer';
        li.onclick = ()=>highlightTeam(s.teamId);
        ul.appendChild(li);
      });
    }

    function getTeamName(data, id){
      const t = data.teams.find(x=>x.id===id);
      return t? t.name : id;
    }

    function highlightTeam(id){
      document.querySelectorAll('#table-standings tbody tr').forEach(r=> r.style.background = '');
      const tr = document.querySelector(`#table-standings tbody tr[data-team-id="${id}"]`);
      if(tr){ tr.style.background = 'rgba(14,165,164,0.08)'; tr.scrollIntoView({behavior:'smooth', block:'center'}); }
    }

    // Render matchdays compact
    function renderMatchdays(data){
      const container = document.getElementById('matchdays');
      container.innerHTML = '';
      data.matchdays.forEach(md=>{
        const div = document.createElement('div');
        div.className = 'matchday';
        const title = document.createElement('div');
        title.style.fontWeight = '700';
        title.style.marginBottom = '8px';
        title.textContent = `Giornata ${md.giornata}${md.date? ' — '+md.date : ''}`;
        div.appendChild(title);

        md.matches.forEach(m=>{
          const mdiv = document.createElement('div');
          mdiv.className = 'match';
          const homeName = getTeamName(data, m.homeId);
          const awayName = getTeamName(data, m.awayId);
          const left = document.createElement('div');
          left.className = 'teams';
          left.innerHTML = `<div style="display:flex;align-items:center;gap:8px"><img src="images/${m.homeId}.png" class="badge" onerror="this.style.display='inline-block'; this.src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAAR0lEQVR4nO3RMQ0AAAjDMO5fNNSwY8Q0cSgkQwYMGDBgwIABAwYMGCBAwYMGDBgwIABAwYMGCBAwYMGDBgwIABAwYMGDBg0Ft8B0S0dXn9gAAAAASUVORK5CYII='"> <div style="font-weight:600">${homeName}</div></div>`;
          const right = document.createElement('div');
          right.className = 'teams';
          right.innerHTML = `<div style="display:flex;align-items:center;gap:8px"><img src="images/${m.awayId}.png" class="badge" onerror="this.style.display='inline-block'; this.src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAAR0lEQVR4nO3RMQ0AAAjDMO5fNNSwY8Q0cSgkQwYMGDBgwIABAwYMGCBAwYMGDBgwIABAwYMGCBAwYMGDBgwIABAwYMGDBg0Ft8B0S0dXn9gAAAAASUVORK5CYII='"> <div style="font-weight:600">${awayName}</div></div>`;

          const score = document.createElement('div');
          score.className = 'score';
          score.innerText = m.score;

          const details = document.createElement('div');
          details.style.flex = '1';
          details.style.marginLeft = '12px';
          // scorers line
          const scorersLine = document.createElement('div');
          const homeSc = (m.scorersHome && m.scorersHome.length)? m.scorersHome.join(', ') : '-';
          const awaySc = (m.scorersAway && m.scorersAway.length)? m.scorersAway.join(', ') : '-';
          scorersLine.className = 'scorers';
          scorersLine.innerHTML = `<em>${homeSc} / ${awaySc}</em>`;
          details.appendChild(scorersLine);

          mdiv.appendChild(left);
          mdiv.appendChild(score);
          mdiv.appendChild(right);
          div.appendChild(mdiv);
          div.appendChild(details);
        });

        container.appendChild(div);
      });
    }

    // Sorting helpers
    function sortBy(key){
      const data = getCurrentData();
      if(key==='pts') data.teams.sort((a,b)=> (b.win*3+b.draw) - (a.win*3+a.draw));
      if(key==='gd') data.teams.sort((a,b)=> ((b.gf-b.ga) - (a.gf-a.ga)) );
      if(key==='gf') data.teams.sort((a,b)=> b.gf - a.gf);
      renderStandings(data);
    }

    // Load data from textarea or fallback
    function getCurrentData(){
      try{ return JSON.parse(document.getElementById('json-data').value); }catch(e){ return initialData; }
    }

    // Apply data from textarea, save to localStorage, re-render
    function applyData(){
      let data;
      try{ data = JSON.parse(document.getElementById('json-data').value); }catch(e){ alert('JSON non valido. Controlla la sintassi.'); return; }
      if(!Array.isArray(data.teams) || !Array.isArray(data.scorers) || !Array.isArray(data.matchdays)){ alert('Il JSON deve contenere teams, scorers e matchdays (tutti array).'); return; }
      localStorage.setItem('campionatoData', document.getElementById('json-data').value);
      renderStandings(data);
      renderScorers(data);
      renderMatchdays(data);
    }

    // Download the current full HTML (snapshot)
    function downloadHTML(){
      const blob = new Blob([document.documentElement.outerHTML], {type:'text/html'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'index.html';
      document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
    }

    // Clear local storage and reload defaults
    function clearStorage(){
      if(confirm('Vuoi cancellare i dati salvati localmente?')) {
        localStorage.removeItem('campionatoData');
        document.getElementById('json-data').value = JSON.stringify(initialData, null, 2);
        applyData();
      }
    }

    // Init on load: populate textarea from localStorage or initialData
    document.addEventListener('DOMContentLoaded', ()=>{
      const saved = localStorage.getItem('campionatoData');
      if(saved){
        document.getElementById('json-data').value = saved;
      } else {
        document.getElementById('json-data').value = JSON.stringify(initialData, null, 2);
      }
      applyData();
    });
  </script>
</body>
</html>
